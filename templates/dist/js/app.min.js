const BIRTH_STORE=function(){let t,e,n,i=!1,a={};return n=function(){let t=new Date,e=function(t){return t%4||t%100==0&&t%400?0:1};return t.myGetDay=function(){let t=this.getDay();return 0===t?6:t-1},{curDay:t.getDate(),curDate:t.myGetDay(),curMonth:t.getMonth()+1,curYear:t.getFullYear(),daysInMonth:function(t,n){return 2===t?28+e(n):31-(t-1)%7%2}}}(),e=function(t){try{let e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}("localStorage"),a.shouldBeSaved=function(){return i},a.dontSaveDataToLocalStorageAgain=function(){i=!1},a.getBirthList=function(){return t},a.listLength=function(){return t.length},a.getRandomCode=function(t){let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length;for(let a=0;a<t;a+=1)e+=n.charAt(Math.floor(Math.random()*i));return e},a.addData=function(e){t.push(e),i=!0},a.find=function(e,n,a){let r=t.length;if(Array.isArray(e))e.forEach(function(e){t.forEach(function(t,i){t.ID===e&&n&&"function"==typeof n&&(a&&"object"==typeof a?n.call(a,i):n(i))})});else if("string"==typeof e)for(let i=0;i<r;i+=1)if(t[i].ID===e)return n&&"function"==typeof n&&(a&&"object"==typeof a?n.call(a,i):n(i)),i;if(i){let e=t.filter(function(t,e){return t});this.replaceData(e)}},a.editData=function(e,n,a,r){if(void 0===r)return function(r){t[r].name=e,t[r].birthDay=n,t[r].note=a,i=!0};t[r].name=e,t[r].birthDay=n,t[r].note=a,i=!0},a.rmData=function(e){delete t[e],i=!0},a.rmAllData=function(){t=[],i=!0},a.saveDataToLocalStorage=function(){localStorage.birthdayList=JSON.stringify(t)},a.replaceData=function(e){t=e},a.rangeOfWeek=function(t,e){let i=[],a=t||n.curDay,r=e>-1?e:n.curDate,l=n.curMonth,c=n.curYear,o=n.daysInMonth,s=l-1==0?o(12,c-1):o(l-1,c),d=o(l,c),R=(l+1===13?o(1,c+1):o(l+1,c),a-r+(a-r<1?s:0)),u=a+7-r-1-(a+7-r-1>d?d:0);if(R>u){let t=a>15?d:s;i.push([],[]);for(let e=R;e<=t;e++)i[0].push(e);for(let t=1;t<=u;t++)i[1].push(t)}else for(let t=R;t<=u;t++)i.push(t);return i},a.filterBirthInMonth=function(t,e){return t.filter(function(t,n){return t.birthDay[1]===e}).sort(function(t,e){return t.birthDay[0]-e.birthDay[0]})},a.filterBirthInWeek=function(e){let i=n.curDay,a=n.curMonth,r=(n.curYear,this.filterBirthInMonth(t,a-1==0?12:a-1)),l=this.filterBirthInMonth(t,a),c=this.filterBirthInMonth(t,a+1===13?1:a+1);if(Array.isArray(e[0])){let t,n;return i>15?(t=l.filter(function(t,n){return-1!==e[0].indexOf(t.birthDay[0])}).sort(function(t,e){return t.birthDay[0]-e.birthDay[0]}),n=c.filter(function(t,n){return-1!==e[1].indexOf(t.birthDay[0])}).sort(function(t,e){return t.birthDay[0]-e.birthDay[0]})):(t=r.filter(function(t,n){return-1!==e[0].indexOf(t.birthDay[0])}).sort(function(t,e){return t.birthDay[0]-e.birthDay[0]}),n=l.filter(function(t,n){return-1!==e[1].indexOf(t.birthDay[0])}).sort(function(t,e){return t.birthDay[0]-e.birthDay[0]})),t.concat(n)}return l.filter(function(t,n){return-1!==e.indexOf(t.birthDay[0])}).sort(function(t,e){return t.birthDay[0]-e.birthDay[0]})},{isStorageAvailable:e,getTime:n,getBirthList:a.getBirthList,listLength:a.listLength,getRandomID:a.getRandomCode,addData:a.addData,find:a.find,editData:a.editData,rmData:a.rmData,rmAllData:a.rmAllData,shouldBeSaved:a.shouldBeSaved,dontSaveDataAgain:a.dontSaveDataAgain,saveDataToLocalStorage:a.saveDataToLocalStorage,replaceData:a.replaceData,rangeOfWeek:a.rangeOfWeek,filterBirthInMonth:a.filterBirthInMonth,filterBirthInWeek:a.filterBirthInWeek}}();if(BIRTH_STORE.isStorageAvailable){const t=void 0!==localStorage.birthdayList?JSON.parse(localStorage.birthdayList):[];BIRTH_STORE.replaceData(t)}else alert("Trình duyệt hiện tại của bạn không hỗ trợ lưu trữ dữ liệu ngoại tuyến.\nChúng tôi sẽ không thể lưu lại dữ liệu bạn nhập hiện tại.");document.addEventListener("DOMContentLoaded",function(){function t(){switch(I.length){case 0:s.classList.remove("lighterTrash"),u.classList.add("fa-plus"),u.classList.remove("fa-pencil");break;case 1:s.classList.add("lighterTrash"),u.classList.remove("fa-plus"),u.classList.add("fa-pencil");break;case 2:u.classList.add("fa-plus"),u.classList.remove("fa-pencil")}}const e=document.getElementsByClassName("overlay")[0],n=document.getElementsByClassName("form-container")[0],i=n.children[0],a=document.getElementById("rstrDataBtn"),r=document.getElementById("inptFileBtn"),l=document.getElementById("bckpDataBtn"),c=document.getElementsByClassName("main-nav__item"),o=c[0],s=c[1],d=c[2],R=c[3],u=R.children[0],h=document.getElementsByClassName("sort-sub-nav")[0],E=h.children,T=E[0],S=E[1],f=E[2],D=document.getElementsByClassName("backup-restore-sub-nav")[0],H=document.getElementsByClassName("birth-list")[0],L=H.children;let I=[];BIRTH_STORE.HANDLERS={createDOMIn:function(t,e,n,i){const a=document.createElement(t);return e&&n&&(a[e]=n),i&&i.appendChild(a),a},addItem:function(t){let e,n,i,a,r,l;e=BIRTH_STORE.HANDLERS.createDOMIn("li",null,null,H),(n=BIRTH_STORE.HANDLERS.createDOMIn("input","type","checkbox",e)).id=t.ID,BIRTH_STORE.HANDLERS.createDOMIn("label","for",t.ID,e),(i=BIRTH_STORE.HANDLERS.createDOMIn("span","textContent",t.ID,e)).style.display="none",BIRTH_STORE.HANDLERS.createDOMIn("h3","textContent",t.name,e),BIRTH_STORE.HANDLERS.createDOMIn("p","textContent",t.note||".",e),a=BIRTH_STORE.HANDLERS.createDOMIn("div","textContent","Day",e),r=BIRTH_STORE.HANDLERS.createDOMIn("div","textContent","Month",e),l=BIRTH_STORE.HANDLERS.createDOMIn("div","textContent","Year",e),a.className=r.className=l.className="birthBlock",BIRTH_STORE.HANDLERS.createDOMIn("br",null,null,a),BIRTH_STORE.HANDLERS.createDOMIn("br",null,null,r),BIRTH_STORE.HANDLERS.createDOMIn("br",null,null,l),BIRTH_STORE.HANDLERS.createDOMIn("span","textContent",t.birthDay[0],a),BIRTH_STORE.HANDLERS.createDOMIn("span","textContent",t.birthDay[1],r),BIRTH_STORE.HANDLERS.createDOMIn("span","textContent",t.birthDay[2],l)},displayItems:function(t){t.forEach(function(t,e){BIRTH_STORE.HANDLERS.addItem(t)},this)},rstrData:"FileReader"in window?function(){BIRTH_STORE.HANDLERS.isEditing?alert("Hãy lưu lại item bạn đang chỉnh sửa."):r.click()}:function(){alert("Rất tiếc, trình duyệt của bạn không hỗ trợ HTML5 FileReader. Vì vậy, chúng tôi không thể khôi phục dữ liệu của bạn.")},inptFile:function(t){let e=t.target.files[0];if(e){let t=new FileReader;t.addEventListener("load",function(t){let e=t.target.result,n=JSON.parse(e);BIRTH_STORE.replaceData(n),BIRTH_STORE.saveDataToLocalStorage()}),t.readAsText(e,"UTF-8")}BIRTH_STORE.HANDLERS.refreshDisplay()},bckpData:function(){if("Blob"in window){function t(t){document.body.removeChild(t.target)}let e=prompt("Hãy đặt tên tập tin dùng để sao lưu dữ liệu","birthdays_backupFile.txt");if(e=""===e?"birthdays_backupFile.txt":e){let n=JSON.stringify(BIRTH_STORE.getBirthList()).replace(/\n/g,"\r\n"),i=new Blob([n],{type:"text/plain"});if("msSaveOrOpenBlob"in navigator)navigator.msSaveOrOpenBlob(i,e);else{let n=document.createElement("a");n.download=e,n.innerHTML="Download File","webkitURL"in window?n.href=window.webkitURL.createObjectURL(i):(n.href=window.URL.createObjectURL(i),n.addEventListener("click",t),n.style.display="none",document.body.appendChild(n)),n.click()}}}else alert("Rất tiếc, trình duyệt của bạn không hỗ trợ HTML5 Blob. Chúng tôi không thể sao lưu dữ liệu của bạn thành 1 tập tin.")},delAll:function(){BIRTH_STORE.listLength?confirm("Bạn có chắc chắn muốn xoá hết dữ liệu không?")&&(H.innerHTML="",BIRTH_STORE.rmAllData(),I=[],t()):alert("Không có dữ liệu để xoá")},dispCurWeek:function(){if(BIRTH_STORE.HANDLERS.isEditing)alert("Hãy lưu lại item bạn đang chỉnh sửa.");else{let e;H.innerHTML="",e=BIRTH_STORE.filterBirthInWeek(BIRTH_STORE.rangeOfWeek()),BIRTH_STORE.HANDLERS.displayItems(e),H.classList.add("birth-list--checkbox-hidden"),I=[],t(),n.classList.contains("form-container--hidden")||R.click(),BIRTH_STORE.HANDLERS.changeState(0)}},dispCurMonth:function(){if(BIRTH_STORE.HANDLERS.isEditing)alert("Hãy lưu lại item bạn đang chỉnh sửa.");else{let e;H.innerHTML="",e=BIRTH_STORE.filterBirthInMonth(BIRTH_STORE.getBirthList(),BIRTH_STORE.getTime.curMonth),BIRTH_STORE.HANDLERS.displayItems(e),H.classList.add("birth-list--checkbox-hidden"),I=[],t(),n.classList.contains("form-container--hidden")||R.click(),BIRTH_STORE.HANDLERS.changeState(1)}},dispAll:function(){BIRTH_STORE.HANDLERS.isEditing?alert("Hãy lưu lại item bạn đang chỉnh sửa."):(H.innerHTML="",BIRTH_STORE.HANDLERS.displayItems(BIRTH_STORE.getBirthList()),H.classList.add("birth-list--checkbox-hidden"),I=[],t(),n.classList.contains("form-container--hidden")||R.click(),BIRTH_STORE.HANDLERS.changeState(2))},clsTab:function(t){return t=t||window.event,BIRTH_STORE.shouldBeSaved()&&(console.log("Dữ liệu đã có sự thay đổi, đang lưu dữ liệu..."),BIRTH_STORE.saveDataToLocalStorage(),BIRTH_STORE.dontSaveDataToLocalStorageAgain()),t&&(t.returnValue="Sure?"),"Sure?"},delCheckedItems:function(){0!==I.length&&confirm("Are you sure?")&&(BIRTH_STORE.HANDLERS.isEditing&&(BIRTH_STORE.HANDLERS.isEditing=!1,i.reset()),I.forEach(function(t){BIRTH_STORE.HANDLERS.findDOM(t).remove()}),BIRTH_STORE.find(I,BIRTH_STORE.rmData),I=[],t(),n.classList.contains("form-container--hidden")||R.click())},rmItem:function(t){I.forEach(function(t){BIRTH_STORE.HANDLERS.findDOM(t).remove()}),t.remove()},addOrEdit:function(t){u.classList.contains("fa-pencil")?BIRTH_STORE.HANDLERS.editItem():(n.classList.toggle("form-container--hidden"),u.classList.toggle("main-nav__item__ico--rotate"),e.classList.toggle("overlay--hidden"),n.classList.contains("form-container--hidden")||i.children[0].focus())},editItem:function(){if(BIRTH_STORE.HANDLERS.isEditing)alert("Hãy lưu lại item bạn đang chỉnh sửa trước khi chỉnh sửa item khác.");else{let t=BIRTH_STORE.HANDLERS.findDOM(I[0]),a=t.children,r=a[2].textContent,l=a[3].textContent,c=a[4].textContent,o=a[5].children[1].textContent,s=a[6].children[1].textContent,d=a[7].children[1].textContent,R=o+"/"+s+"/"+d,h=i.children[0],E=i.children[1],T=i.children[2],S=i.children[3],f=i.children[4];n.classList.contains("form-container--hidden")&&(n.classList.remove("form-container--hidden"),u.classList.add("main-nav__item__ico--rotate"),e.classList.remove("overlay--hidden")),h.value=l,E.value=R,T.value=c,S.value=r,f.textContent="Save",i.children[0].focus(),BIRTH_STORE.HANDLERS.curItem=t,BIRTH_STORE.HANDLERS.isEditing=!0}},saveItem:function(){let t=BIRTH_STORE.HANDLERS.curItem.children,a=t[2].textContent,r=t[3],l=t[4],c=t[5].children[1],o=t[6].children[1],s=t[7].children[1],d=i.children[0].value,R=i.children[1].value.split("/").map(function(t,e){return~~t}),h=i.children[2].value,E=i.children[3],T=BIRTH_STORE.editData(d,R,h);BIRTH_STORE.find(a,T),r.textContent=d,l.textContent=h,c.textContent=R[0],o.textContent=R[1],s.textContent=R[2],E.textContent="Submit",i.reset(),n.classList.add("form-container--hidden"),u.classList.remove("main-nav__item__ico--rotate"),e.classList.add("overlay--hidden"),BIRTH_STORE.HANDLERS.isEditing=!1},sbmtForm:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;let e=i.children[0],n=i.children[1],a=i.children[2],r=i.children[3],l=i.children[4];if("Submit"===l.textContent)if(r.value=BIRTH_STORE.getRandomID(4),""===e.value)alert("Hãy nhập tên người bạn muốn lưu giữ ngày sinh nhật!");else{let t=n.value.split("/").map(function(t,e){return~~t}),l={ID:r.value,name:e.value,birthDay:t,note:a.value};BIRTH_STORE.HANDLERS.addItem(l),BIRTH_STORE.addData(l),i.reset(),i.children[0].focus(),BIRTH_STORE.saveDataToLocalStorage()}else"Save"===l.textContent&&BIRTH_STORE.HANDLERS.saveItem()},longPressOnItem:function(t){let e=t.target,n=(e.children[0],e.children[2]);0===I.length&&(H.classList.remove("birth-list--checkbox-hidden"),"LI"===e.tagName&&(e.children[0].checked=!0,I.push(n.textContent)))},clckItem:function(e){let n=e.target,i=n.children[0],a=n.children[2];if(!H.classList.contains("birth-list--checkbox-hidden")&&"LI"===n.tagName){if(i.click(),i.checked)-1===I.indexOf(a.textContent)&&I.push(a.textContent);else if(I.indexOf(a.textContent)>-1){let t=I.indexOf(a.textContent);I.splice(t,1)}t()}},findDOM:function(t){let e=L.length;for(let n=0;n<e;n+=1)if(t===L[n].children[2].textContent)return L[n]},changeState:function(t){let e=BIRTH_STORE.HANDLERS.dispState;E[e].classList.remove("sort-sub-nav__item--present-state"),E[t].classList.add("sort-sub-nav__item--present-state"),BIRTH_STORE.HANDLERS.dispState=t},refreshDisplay:function(){E[BIRTH_STORE.HANDLERS.dispState].click()},idx:0,curItem:null,isEditing:!1,dispState:0},i.addEventListener("submit",BIRTH_STORE.HANDLERS.sbmtForm.bind(BIRTH_STORE.HANDLERS),!1),a.addEventListener("click",BIRTH_STORE.HANDLERS.rstrData,!1),r.addEventListener("change",BIRTH_STORE.HANDLERS.inptFile,!1),l.addEventListener("click",BIRTH_STORE.HANDLERS.bckpData,!1),window.addEventListener("beforeunload",BIRTH_STORE.HANDLERS.clsTab,!1),R.addEventListener("click",BIRTH_STORE.HANDLERS.addOrEdit.bind(BIRTH_STORE.HANDLERS),!1),T.addEventListener("click",BIRTH_STORE.HANDLERS.dispCurWeek.bind(BIRTH_STORE.HANDLERS),!1),S.addEventListener("click",BIRTH_STORE.HANDLERS.dispCurMonth.bind(BIRTH_STORE.HANDLERS),!1),f.addEventListener("click",BIRTH_STORE.HANDLERS.dispAll.bind(BIRTH_STORE.HANDLERS),!1),H.addEventListener("click",BIRTH_STORE.HANDLERS.clckItem.bind(BIRTH_STORE.HANDLERS),!1),e.addEventListener("click",function(){R.click()}),o.addEventListener("click",function(){D.classList.add("translatedDown100"),h.classList.toggle("translatedDown200")}),d.addEventListener("click",function(){h.classList.add("translatedDown200"),D.classList.toggle("translatedDown100")}),s.addEventListener("click",BIRTH_STORE.HANDLERS.delCheckedItems,!1),function(){function t(t){a=setTimeout(function(){BIRTH_STORE.HANDLERS.longPressOnItem(t)},1e3)}function e(){clearTimeout(a)}function n(){r=setTimeout(BIRTH_STORE.HANDLERS.delAll,1e3)}function i(){clearTimeout(r)}var a,r;H.addEventListener("mousedown",t,!1),H.addEventListener("mouseup",e,!1),H.addEventListener("touchstart",t,!1),H.addEventListener("touchend",e,!1),s.addEventListener("mousedown",n,!1),s.addEventListener("mouseup",i,!1),s.addEventListener("touchstart",n,!1),s.addEventListener("touchend",i,!1)}(),T.click()});